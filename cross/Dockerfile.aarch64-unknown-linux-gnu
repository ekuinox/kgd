FROM ghcr.io/cross-rs/aarch64-unknown-linux-gnu:main

# Ubuntu 22.04 の apt sources を追加して GCC 11+ を取得
RUN sed -i 's/focal/jammy/g' /etc/apt/sources.list

# libheif v1.21.2 は C++20 を要求するため GCC 11+ が必要
RUN dpkg --add-architecture arm64 && \
    apt-get update && \
    apt-get install -y --no-install-recommends \
        cmake \
        ninja-build \
        libclang-dev \
        g++-11-aarch64-linux-gnu \
        libde265-dev:arm64 \
        libx265-dev:arm64 \
        libaom-dev:arm64 \
        libwebp-dev:arm64 \
        zlib1g-dev:arm64 \
        libjpeg-dev:arm64 \
        libnuma-dev:arm64 && \
    rm -rf /var/lib/apt/lists/*

# GCC 11 をデフォルトに設定
ENV CXX_aarch64_unknown_linux_gnu=aarch64-linux-gnu-g++-11
